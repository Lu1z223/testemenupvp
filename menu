-- // CONFIGURAÇÃO INICIAL
local Settings = {
    TeamCheck = true,
    BoxEnabled = true,
    LineEnabled = true,
    BoxColor = Color3.fromRGB(255, 0, 0),
    LineColor = Color3.fromRGB(255, 0, 0),
    BoxThickness = 1,
    LineThickness = 1,

    -- Aimbot
    AimbotEnabled = true,
    AimFOV = 100,
    AimPart = "Head",
    AimSmoothness = 0.25
}

-- // INTERFACE
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 220, 0, 250)
Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.Active = true
Frame.Draggable = true

local function CreateButton(text, posY, callback)
    local btn = Instance.new("TextButton", Frame)
    btn.Size = UDim2.new(1, -10, 0, 25)
    btn.Position = UDim2.new(0, 5, 0, posY)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.MouseButton1Click:Connect(callback)
end

-- Botões ESP
CreateButton("Toggle ESP Box", 5, function()
    Settings.BoxEnabled = not Settings.BoxEnabled
end)

CreateButton("Toggle ESP Linha", 35, function()
    Settings.LineEnabled = not Settings.LineEnabled
end)

CreateButton("Toggle Team Check", 65, function()
    Settings.TeamCheck = not Settings.TeamCheck
end)

-- Botões Aimbot
CreateButton("Aumentar FOV", 95, function()
    Settings.AimFOV = Settings.AimFOV + 10
end)

CreateButton("Diminuir FOV", 125, function()
    Settings.AimFOV = math.max(10, Settings.AimFOV - 10)
end)

-- Mostrar valor do FOV
local FOVLabel = Instance.new("TextLabel", Frame)
FOVLabel.Size = UDim2.new(1, -10, 0, 25)
FOVLabel.Position = UDim2.new(0, 5, 0, 155)
FOVLabel.BackgroundTransparency = 1
FOVLabel.TextColor3 = Color3.new(1, 1, 1)
FOVLabel.Text = "FOV: " .. Settings.AimFOV

-- Atualizar valor do FOV na tela
game:GetService("RunService").RenderStepped:Connect(function()
    FOVLabel.Text = "FOV: " .. Settings.AimFOV
end)

-- // FUNÇÕES ÚTEIS
local function GetTeam(plr)
    return plr.Team or nil
end

local function GetClosestPlayer()
    local closest = nil
    local shortestDistance = Settings.AimFOV

    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Character and player.Character:FindFirstChild(Settings.AimPart) then
            if Settings.TeamCheck and GetTeam(player) == GetTeam(game.Players.LocalPlayer) then
                continue
            end

            local pos, visible = workspace.CurrentCamera:WorldToViewportPoint(player.Character[Settings.AimPart].Position)
            if visible then
                local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(workspace.CurrentCamera.ViewportSize.X/2, workspace.CurrentCamera.ViewportSize.Y/2)).Magnitude
                if dist < shortestDistance then
                    shortestDistance = dist
                    closest = player
                end
            end
        end
    end
    return closest
end

-- // CRIAÇÃO DO ESP
local function CreateESP(player)
    if player == game.Players.LocalPlayer then return end

    local box = Drawing.new("Square")
    box.Thickness = Settings.BoxThickness
    box.Color = Settings.BoxColor
    box.Filled = false

    local line = Drawing.new("Line")
    line.Thickness = Settings.LineThickness
    line.Color = Settings.LineColor

    game:GetService("RunService").RenderStepped:Connect(function()
        pcall(function()
            if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") or not player.Character:FindFirstChild("Humanoid") then
                box.Visible = false
                line.Visible = false
                return
            end

            if Settings.TeamCheck and GetTeam(player) == GetTeam(game.Players.LocalPlayer) then
                box.Visible = false
                line.Visible = false
                return
            end

            local root = player.Character.HumanoidRootPart
            local head = player.Character:FindFirstChild("Head")

            local rootPos, rootVis = workspace.CurrentCamera:WorldToViewportPoint(root.Position)
            local headPos = workspace.CurrentCamera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
            local legPos = workspace.CurrentCamera:WorldToViewportPoint(root.Position - Vector3.new(0, 3, 0))

            if rootVis then
                if Settings.BoxEnabled then
                    box.Size = Vector2.new(2000 / rootPos.Z, headPos.Y - legPos.Y)
                    box.Position = Vector2.new(rootPos.X - box.Size.X / 2, rootPos.Y - box.Size.Y / 2)
                    box.Color = Settings.BoxColor
                    box.Visible = true
                else
                    box.Visible = false
                end

                if Settings.LineEnabled then
                    line.From = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y)
                    line.To = Vector2.new(rootPos.X, rootPos.Y)
                    line.Color = Settings.LineColor
                    line.Visible = true
                else
                    line.Visible = false
                end
            else
                box.Visible = false
                line.Visible = false
            end
        end)
    end)
end

-- Adiciona ESP
for _, plr in pairs(game.Players:GetPlayers()) do
    CreateESP(plr)
end
game.Players.PlayerAdded:Connect(CreateESP)

-- // FOV Circle
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 1
fovCircle.Filled = false
fovCircle.Color = Color3.fromRGB(0, 255, 0)
fovCircle.Transparency = 1

-- // AIMBOT AO ATIRAR
local UserInputService = game:GetService("UserInputService")

game:GetService("RunService").RenderStepped:Connect(function()
    fovCircle.Position = Vector2.new(workspace.CurrentCamera.ViewportSize.X/2, workspace.CurrentCamera.ViewportSize.Y/2)
    fovCircle.Radius = Settings.AimFOV
    fovCircle.Visible = Settings.AimbotEnabled

    -- Verifica se está atirando
    if Settings.AimbotEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
        local target = GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild(Settings.AimPart) then
            local targetPos = workspace.CurrentCamera:WorldToViewportPoint(target.Character[Settings.AimPart].Position)
            mousemoverel(
                (targetPos.X - workspace.CurrentCamera.ViewportSize.X/2) * Settings.AimSmoothness,
                (targetPos.Y - workspace.CurrentCamera.ViewportSize.Y/2) * Settings.AimSmoothness
            )
        end
    end
end)
