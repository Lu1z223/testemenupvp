-- =========================================
-- Injection ModMenu com ESP para celular
-- =========================================

-- Biblioteca ArrayField
local ArrayField = loadstring(game:HttpGet("https://raw.githubusercontent.com/Hosvile/Refinement/main/MC%3AArrayfield%20Library"))()

-- Criação da janela
local Window = ArrayField:CreateWindow({
    Name = "Injection ModMenu",
    LoadingTitle = "Injection ModMenu",
    LoadingSubtitle = "by YourName",
    ConfigurationSaving = {Enabled = true, FolderName = "InjectionMod", FileName = "Config"},
    Discord = {Enabled = false},
    KeySystem = false
})

-- ========================
-- Aba ESP
-- ========================
local ESP_Tab = Window:CreateTab("ESP")
local ESP_Section = ESP_Tab:CreateSection("ESP Settings")

-- Configurações ESP
local ESPSettings = {
    Enabled = true,
    Box = true,
    Line = true,
    TeamCheck = true,
    BoxColor = Color3.fromRGB(255,0,0),
    LineColor = Color3.fromRGB(255,0,0)
}

-- Toggle ESP Ativo
ESP_Tab:CreateToggle({
    Name = "ESP Ativo",
    SectionParent = ESP_Section,
    CurrentValue = true,
    Flag = "ESPEnabled",
    Callback = function(Value)
        ESPSettings.Enabled = Value
    end
})

-- Toggle Box
ESP_Tab:CreateToggle({
    Name = "ESP Box",
    SectionParent = ESP_Section,
    CurrentValue = true,
    Flag = "ESPBox",
    Callback = function(Value)
        ESPSettings.Box = Value
    end
})

-- Toggle Linha
ESP_Tab:CreateToggle({
    Name = "ESP Linha",
    SectionParent = ESP_Section,
    CurrentValue = true,
    Flag = "ESPLine",
    Callback = function(Value)
        ESPSettings.Line = Value
    end
})

-- Toggle Team Check
ESP_Tab:CreateToggle({
    Name = "Team Check",
    SectionParent = ESP_Section,
    CurrentValue = true,
    Flag = "ESPTeamCheck",
    Callback = function(Value)
        ESPSettings.TeamCheck = Value
    end
})

-- ColorPickers
ESP_Tab:CreateColorPicker({
    Name = "Cor Box",
    SectionParent = ESP_Section,
    Color = ESPSettings.BoxColor,
    Flag = "ESPBoxColor",
    Callback = function(Value)
        ESPSettings.BoxColor = Value
    end
})

ESP_Tab:CreateColorPicker({
    Name = "Cor Linha",
    SectionParent = ESP_Section,
    Color = ESPSettings.LineColor,
    Flag = "ESPLineColor",
    Callback = function(Value)
        ESPSettings.LineColor = Value
    end
})

-- ========================
-- Função ESP
-- ========================
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local ESPObjects = {}

local function CreateESP(player)
    if player == LocalPlayer then return end
    local box = Drawing.new("Square")
    box.Thickness = 1
    box.Filled = false
    box.Color = ESPSettings.BoxColor

    local line = Drawing.new("Line")
    line.Thickness = 1
    line.Color = ESPSettings.LineColor

    ESPObjects[player] = {Box = box, Line = line}
end

for _, plr in pairs(Players:GetPlayers()) do
    CreateESP(plr)
end
Players.PlayerAdded:Connect(CreateESP)

RunService.RenderStepped:Connect(function()
    if not ESPSettings.Enabled then
        for _, obj in pairs(ESPObjects) do
            obj.Box.Visible = false
            obj.Line.Visible = false
        end
        return
    end

    for player, objects in pairs(ESPObjects) do
        local char = player.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") or not char:FindFirstChild("Humanoid") then
            objects.Box.Visible = false
            objects.Line.Visible = false
            continue
        end

        if ESPSettings.TeamCheck and player.Team == LocalPlayer.Team then
            objects.Box.Visible = false
            objects.Line.Visible = false
            continue
        end

        local root = char.HumanoidRootPart
        local head = char:FindFirstChild("Head")
        local rootPos, onScreen = Camera:WorldToViewportPoint(root.Position)
        local headPos = Camera:WorldToViewportPoint(head.Position + Vector3.new(0,0.5,0))
        local footPos = Camera:WorldToViewportPoint(root.Position - Vector3.new(0,3,0))

        if onScreen then
            if ESPSettings.Box then
                local width = (2000 / rootPos.Z)
                local height = headPos.Y - footPos.Y
                objects.Box.Size = Vector2.new(width, height)
                objects.Box.Position = Vector2.new(rootPos.X - width/2, rootPos.Y - height/2)
                objects.Box.Color = ESPSettings.BoxColor
                objects.Box.Visible = true
            else
                objects.Box.Visible = false
            end

            if ESPSettings.Line then
                objects.Line.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                objects.Line.To = Vector2.new(rootPos.X, rootPos.Y)
                objects.Line.Color = ESPSettings.LineColor
                objects.Line.Visible = true
            else
                objects.Line.Visible = false
            end
        else
            objects.Box.Visible = false
            objects.Line.Visible = false
        end
    end
end)

-- ========================
-- Botão flutuante para celular
-- ========================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "InjectionModMenuGui"
ScreenGui.Parent = game:GetService("CoreGui")

local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0,120,0,40)
ToggleButton.Position = UDim2.new(0,20,0,20)
ToggleButton.BackgroundColor3 = Color3.fromRGB(50,50,50)
ToggleButton.TextColor3 = Color3.new(1,1,1)
ToggleButton.Text = "Menu"
ToggleButton.Parent = ScreenGui

local MenuVisible = true
ToggleButton.MouseButton1Click:Connect(function()
    if MenuVisible then
        Window:Hide()
    else
        Window:Show()
    end
    MenuVisible = not MenuVisible
end)

print("Injection ModMenu carregado! Use o botão flutuante para abrir/fechar o menu no celular.")
