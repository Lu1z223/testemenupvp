-- Carrega ArrayField
local ArrayField = loadstring(game:HttpGet("https://raw.githubusercontent.com/Hosvile/Refinement/main/MC%3AArrayfield%20Library"))()

-- Cria a janela principal
local Window = ArrayField:CreateWindow({
    Name = "Injection ModMenu",
    LoadingTitle = "Injection ModMenu",
    LoadingSubtitle = "by Luiz",
    ConfigurationSaving = { Enabled = true, FolderName = nil, FileName = "InjectionModMenu" },
    Discord = { Enabled = false },
    KeySystem = false
})

-- Variável de controle do menu
local MenuOpen = true

-- Botão flutuante para abrir/fechar o menu
local ScreenGui = Instance.new("ScreenGui", game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.Name = "ModMenuButtonGui"

local OpenButton = Instance.new("TextButton", ScreenGui)
OpenButton.Size = UDim2.new(0, 150, 0, 50)
OpenButton.Position = UDim2.new(0, 20, 0, 100)
OpenButton.Text = "Fechar Menu"
OpenButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
OpenButton.TextColor3 = Color3.fromRGB(255, 255, 255)
OpenButton.TextScaled = true

OpenButton.MouseButton1Click:Connect(function()
    if MenuOpen then
        Window:Hide() -- Esconde o menu
        OpenButton.Text = "Abrir Menu"
        MenuOpen = false
    else
        Window:Show() -- Mostra o menu
        OpenButton.Text = "Fechar Menu"
        MenuOpen = true
    end
end)

-- Criação da aba ESP
local ESPTab = Window:CreateTab("ESP")
local ESPSection = ESPTab:CreateSection("ESP Settings")

-- Função para criar ESP Box
local function CreateESPBox(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and not player.Character.HumanoidRootPart:FindFirstChild("ESPBox") then
        local hrp = player.Character.HumanoidRootPart
        local box = Instance.new("BillboardGui")
        box.Name = "ESPBox"
        box.Size = UDim2.new(0, 100, 0, 100)
        box.AlwaysOnTop = true
        box.Adornee = hrp
        local frame = Instance.new("Frame", box)
        frame.Size = UDim2.new(1,0,1,0)
        frame.BackgroundColor3 = Color3.fromRGB(0,255,0)
        frame.BackgroundTransparency = 0.5
        box.Parent = hrp
    end
end

-- Função para criar ESP Line
local function CreateESPLine(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = player.Character.HumanoidRootPart
        if not hrp:FindFirstChild("ESPLine") then
            local line = Instance.new("BillboardGui")
            line.Name = "ESPLine"
            line.Size = UDim2.new(0, 2, 0, 200)
            line.AlwaysOnTop = true
            line.Adornee = hrp
            local frame = Instance.new("Frame", line)
            frame.Size = UDim2.new(1,0,1,0)
            frame.BackgroundColor3 = Color3.fromRGB(255,0,0)
            frame.BackgroundTransparency = 0.5
            line.Parent = hrp
        end
    end
end

-- Button para ativar ESP Box
ESPSection:CreateButton({
    Name = "ESP Box",
    Callback = function()
        print("ESP Box ativado")
        spawn(function()
            for i,v in pairs(game:GetService("Players"):GetPlayers()) do
                if v ~= game.Players.LocalPlayer then
                    CreateESPBox(v)
                end
            end
        end)
    end
})

-- Button para ativar ESP Line
ESPSection:CreateButton({
    Name = "ESP Line",
    Callback = function()
        print("ESP Line ativado")
        spawn(function()
            for i,v in pairs(game:GetService("Players"):GetPlayers()) do
                if v ~= game.Players.LocalPlayer then
                    CreateESPLine(v)
                end
            end
        end)
    end
})

-- Toggle para mostrar/ocultar menu rapidamente
local MenuToggleSection = Window:CreateTab("Menu")
local MenuToggle = MenuToggleSection:CreateSection("Menu Control")
MenuToggle:CreateButton({
    Name = "Abrir/Fechar Menu",
    Callback = function()
        if MenuOpen then
            Window:Hide()
            OpenButton.Text = "Abrir Menu"
            MenuOpen = false
        else
            Window:Show()
            OpenButton.Text = "Fechar Menu"
            MenuOpen = true
        end
    end
})
